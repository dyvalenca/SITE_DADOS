<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BrasileirÃ£o â€” NÃºmeros Fieis - Corinthians</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: #f1f1f3;
      color: #18181b;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    /* â”€â”€ HEADER â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      position: fixed; top: 0; left: 0; right: 0; z-index: 100;
      background: #fff; border-bottom: 1px solid #e4e4e7;
      padding: 0 28px; height: 58px;
      display: flex; align-items: center; justify-content: space-between;
    }
    .logo { font-size: 1.05rem; font-weight: 900; letter-spacing: -0.5px; color: #18181b; }
    .logo span { color: #52525b; font-weight: 600; }
    .header-nav { display: flex; align-items: center; gap: 10px; }
    .btn-nav {
      color: #71717a; font-size: 0.8rem; text-decoration: none;
      border: 1px solid #d4d4d8; border-radius: 8px; padding: 6px 14px;
      transition: all 0.15s; white-space: nowrap;
    }
    .btn-nav:hover { color: #18181b; border-color: #a1a1aa; }
    .btn-nav.ativo { color: #18181b; border-color: #18181b; font-weight: 700; }

    /* â”€â”€ LAYOUT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    main {
      padding-top: 90px; padding-bottom: 80px;
      max-width: 960px; margin: 0 auto;
      padding-left: 20px; padding-right: 20px;
    }

    section { margin-bottom: 48px; }

    .section-title {
      font-size: 0.65rem; font-weight: 700;
      letter-spacing: 2.5px; text-transform: uppercase;
      color: #a1a1aa; margin-bottom: 18px;
      padding-bottom: 10px; border-bottom: 1px solid #e4e4e7;
    }

    /* â”€â”€ LOADING â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #loading {
      text-align: center; padding: 80px 20px;
      color: #a1a1aa; font-size: 0.85rem; letter-spacing: 2px;
    }
    .spinner {
      width: 32px; height: 32px; border: 3px solid #e4e4e7;
      border-top-color: #7c3aed; border-radius: 50%;
      animation: spin 0.8s linear infinite; margin: 0 auto 16px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* â”€â”€ TOGGLE BUTTONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .toggle-group { display: flex; gap: 6px; flex-wrap: wrap; }
    .toggle-btn {
      background: #fff; border: 1px solid #d4d4d8;
      border-radius: 8px; padding: 7px 16px;
      font-size: 0.78rem; font-weight: 600; color: #71717a;
      cursor: pointer; transition: all 0.15s;
      font-family: 'Inter', sans-serif; line-height: 1;
    }
    .toggle-btn:hover { border-color: #a1a1aa; color: #18181b; }
    .toggle-btn.ativo { background: #18181b; border-color: #18181b; color: #fff; }
    .toggle-btn.titulo-ativo { background: #f59e0b; border-color: #d97706; color: #fff; }

    /* â”€â”€ CHART CARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .chart-card {
      background: #fff; border: 1px solid #e4e4e7;
      border-radius: 16px; padding: 28px 24px;
    }
    .chart-header {
      display: flex; justify-content: space-between;
      align-items: flex-start; margin-bottom: 22px;
      flex-wrap: wrap; gap: 14px;
    }
    .chart-title {
      font-size: 0.9rem; font-weight: 800;
      letter-spacing: -0.3px; color: #18181b; margin-bottom: 4px;
    }
    .chart-subtitle { font-size: 0.7rem; color: #a1a1aa; font-weight: 500; }
    .chart-container { position: relative; height: 300px; }
    .chart-legend {
      display: flex; align-items: center; gap: 20px;
      margin-top: 18px; flex-wrap: wrap;
    }
    .legend-item {
      display: flex; align-items: center; gap: 6px;
      font-size: 0.72rem; color: #71717a; font-weight: 500;
    }
    .legend-dot { width: 10px; height: 10px; border-radius: 50%; }
    .legend-star {
      width: 12px; height: 12px; background: #f59e0b;
      border-radius: 2px; transform: rotate(45deg);
    }

    /* â”€â”€ ERA STATS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .era-stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
      gap: 10px;
    }
    .era-stat-card {
      background: #fff; border: 1px solid #e4e4e7;
      border-radius: 14px; padding: 18px 16px;
    }
    .era-stat-valor {
      font-size: 2rem; font-weight: 900;
      letter-spacing: -1.5px; line-height: 1;
      color: #18181b; margin-bottom: 6px;
    }
    .era-stat-label {
      font-size: 0.6rem; font-weight: 700;
      letter-spacing: 1.8px; text-transform: uppercase; color: #a1a1aa;
    }
    .era-stat-card.destaque-aprov .era-stat-valor { color: #7c3aed; }
    .era-stat-card.destaque-v .era-stat-valor    { color: #2563eb; }
    .era-stat-card.destaque-d .era-stat-valor    { color: #dc2626; }
    .era-stat-card.destaque-gp .era-stat-valor   { color: #7c3aed; }
    .era-stat-card.destaque-gc .era-stat-valor   { color: #dc2626; }

    /* â”€â”€ H2H GRID â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .h2h-search-wrap {
      display: flex; align-items: center; gap: 12px;
      margin-bottom: 16px; flex-wrap: wrap;
    }
    #h2h-busca {
      background: #fff; color: #18181b; border: 1px solid #d4d4d8;
      border-radius: 10px; padding: 8px 14px; font-size: 0.85rem;
      font-family: 'Inter', sans-serif; outline: none;
      font-weight: 500; flex: 1; min-width: 180px; max-width: 320px;
    }
    #h2h-busca:focus { border-color: #7c3aed; }
    .h2h-sort-group { display: flex; gap: 6px; }
    .h2h-sort-btn {
      background: #fff; border: 1px solid #d4d4d8; border-radius: 8px;
      padding: 6px 12px; font-size: 0.72rem; font-weight: 600;
      color: #71717a; cursor: pointer; font-family: 'Inter', sans-serif;
      transition: all 0.15s;
    }
    .h2h-sort-btn:hover { color: #18181b; border-color: #a1a1aa; }
    .h2h-sort-btn.ativo { background: #18181b; border-color: #18181b; color: #fff; }

    /* â”€â”€ RESUMO H2H â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .h2h-resumo {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px; margin-bottom: 14px;
    }
    .h2h-resumo-card {
      border-radius: 12px; padding: 14px 16px;
      display: flex; align-items: center; gap: 14px;
      border: 1px solid transparent;
    }
    .h2h-resumo-card.rc-vence     { background: #bfdbfe; border-color: #93c5fd; }
    .h2h-resumo-card.rc-equilibrado { background: #fde68a; border-color: #fcd34d; }
    .h2h-resumo-card.rc-perde     { background: #fecaca; border-color: #fca5a5; }
    .h2h-resumo-num {
      font-size: 2rem; font-weight: 900; letter-spacing: -2px; line-height: 1;
    }
    .rc-vence      .h2h-resumo-num { color: #1e40af; }
    .rc-equilibrado .h2h-resumo-num { color: #92400e; }
    .rc-perde      .h2h-resumo-num { color: #991b1b; }
    .h2h-resumo-txt {}
    .h2h-resumo-label {
      font-size: 0.72rem; font-weight: 700; line-height: 1.3;
    }
    .rc-vence      .h2h-resumo-label { color: #1e40af; }
    .rc-equilibrado .h2h-resumo-label { color: #92400e; }
    .rc-perde      .h2h-resumo-label { color: #991b1b; }
    .h2h-resumo-sub {
      font-size: 0.62rem; font-weight: 500; margin-top: 2px;
    }
    .rc-vence      .h2h-resumo-sub { color: #3b82f6; }
    .rc-equilibrado .h2h-resumo-sub { color: #b45309; }
    .rc-perde      .h2h-resumo-sub { color: #ef4444; }

    /* barra proporcional de confrontos */
    .h2h-resumo-barra-wrap { margin-bottom: 14px; }
    .h2h-resumo-barra {
      height: 6px; border-radius: 4px; display: flex; overflow: hidden; gap: 2px;
    }
    .hrb-v { background: #2563eb; border-radius: 3px; }
    .hrb-e { background: #fcd34d; border-radius: 3px; }
    .hrb-d { background: #dc2626; border-radius: 3px; }

    @media (max-width: 480px) {
      .h2h-resumo { grid-template-columns: 1fr; }
      .h2h-resumo-card { padding: 12px 14px; }
      .h2h-resumo-num { font-size: 1.6rem; }
    }

    .h2h-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(270px, 1fr));
      gap: 10px;
    }

    /* â”€â”€ H2H CARD BASE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .h2h-card {
      border-radius: 14px; padding: 16px 18px;
      cursor: pointer; transition: filter 0.12s, box-shadow 0.15s;
      border: 1px solid transparent;
    }
    .h2h-card:hover { filter: brightness(0.93); box-shadow: 0 4px 16px rgba(0,0,0,0.1); }

    /* Azul â€” mais vitÃ³rias (igual .vitoria no jogos.html) */
    .h2h-card.h2h-vence {
      background: #bfdbfe; border-color: #93c5fd;
    }
    .h2h-card.h2h-vence .h2h-adv  { color: #1e40af; }
    .h2h-card.h2h-vence .h2h-aprov { color: #1e3a8a; }
    .h2h-card.h2h-vence .h2h-jogos { color: #60a5fa; }
    .h2h-card.h2h-vence .h2h-record-sep { color: #93c5fd; }
    .h2h-card.h2h-vence .h2h-gols { color: #60a5fa; }
    .h2h-card.h2h-vence .h2h-bar-e { background: #93c5fd; }

    /* Amarelo â€” equilÃ­brio (igual .empate no jogos.html) */
    .h2h-card.h2h-equilibrado {
      background: #fde68a; border-color: #fcd34d;
    }
    .h2h-card.h2h-equilibrado .h2h-adv  { color: #78350f; }
    .h2h-card.h2h-equilibrado .h2h-aprov { color: #92400e; }
    .h2h-card.h2h-equilibrado .h2h-jogos { color: #d97706; }
    .h2h-card.h2h-equilibrado .h2h-record-sep { color: #fcd34d; }
    .h2h-card.h2h-equilibrado .h2h-gols { color: #b45309; }
    .h2h-card.h2h-equilibrado .h2h-bar-e { background: #fcd34d; }

    /* Vermelho â€” mais derrotas (igual .derrota no jogos.html) */
    .h2h-card.h2h-perde {
      background: #fecaca; border-color: #fca5a5;
    }
    .h2h-card.h2h-perde .h2h-adv  { color: #991b1b; }
    .h2h-card.h2h-perde .h2h-aprov { color: #7f1d1d; }
    .h2h-card.h2h-perde .h2h-jogos { color: #f87171; }
    .h2h-card.h2h-perde .h2h-record-sep { color: #fca5a5; }
    .h2h-card.h2h-perde .h2h-gols { color: #ef4444; }
    .h2h-card.h2h-perde .h2h-bar-e { background: #fca5a5; }

    .h2h-header {
      display: flex; justify-content: space-between;
      align-items: flex-start; margin-bottom: 10px;
    }
    .h2h-adv {
      font-size: 0.85rem; font-weight: 700; letter-spacing: -0.2px;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px;
    }
    .h2h-aprov { font-size: 1.1rem; font-weight: 900; letter-spacing: -0.5px; white-space: nowrap; }
    .h2h-record { display: flex; gap: 10px; margin-bottom: 10px; align-items: center; }
    .h2h-record-item { font-size: 0.72rem; font-weight: 700; }
    .h2h-record-item .val { font-size: 1rem; font-weight: 900; }
    .h2h-record-item.h2h-v .val { color: #2563eb; }
    .h2h-record-item.h2h-e .val { color: #9ca3af; }
    .h2h-record-item.h2h-d .val { color: #dc2626; }
    .h2h-record-item .lbl { color: inherit; opacity: 0.6; font-size: 0.62rem; }
    .h2h-record-sep { font-weight: 300; }
    .h2h-jogos { font-size: 0.65rem; margin-left: auto; }
    .h2h-bar {
      height: 5px; border-radius: 3px;
      display: flex; overflow: hidden; gap: 1px;
    }
    .h2h-bar-seg { height: 100%; border-radius: 2px; }
    .h2h-bar-v { background: #2563eb; }
    .h2h-bar-e { background: #d1d5db; }
    .h2h-bar-d { background: #dc2626; }
    .h2h-gols { display: flex; gap: 8px; margin-top: 8px; font-size: 0.65rem; }
    .h2h-gols span { font-weight: 600; }
    .h2h-hint {
      margin-top: 10px; font-size: 0.6rem; font-weight: 600;
      letter-spacing: 0.8px; opacity: 0.5; text-align: right;
    }

    /* â”€â”€ PAINEL LATERAL (DRAWER) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .painel-overlay {
      position: fixed; inset: 0; background: rgba(0,0,0,0.45);
      z-index: 199; opacity: 0; pointer-events: none;
      transition: opacity 0.25s;
    }
    .painel-overlay.aberto { opacity: 1; pointer-events: all; }

    .painel {
      position: fixed; top: 0; right: 0; bottom: 0;
      width: 500px; max-width: 100vw;
      background: #f1f1f3;
      border-left: 1px solid #e4e4e7;
      z-index: 200;
      transform: translateX(100%);
      transition: transform 0.28s cubic-bezier(0.4, 0, 0.2, 1);
      display: flex; flex-direction: column;
      overflow: hidden;
    }
    .painel.aberto { transform: translateX(0); }

    .painel-header {
      background: #fff; border-bottom: 1px solid #e4e4e7;
      padding: 18px 22px 16px; flex-shrink: 0;
    }
    .painel-header-top {
      display: flex; align-items: flex-start;
      justify-content: space-between; gap: 12px; margin-bottom: 6px;
    }
    .painel-adv-nome {
      font-size: 1rem; font-weight: 900; letter-spacing: -0.3px;
      color: #18181b; line-height: 1.2;
    }
    .painel-fechar {
      background: none; border: 1px solid #d4d4d8; border-radius: 8px;
      width: 32px; height: 32px; cursor: pointer; font-size: 1rem;
      color: #71717a; flex-shrink: 0; display: flex;
      align-items: center; justify-content: center;
      transition: all 0.15s; font-family: 'Inter', sans-serif;
    }
    .painel-fechar:hover { color: #18181b; border-color: #a1a1aa; }
    .painel-adv-meta {
      font-size: 0.72rem; color: #71717a; font-weight: 500;
    }
    .painel-adv-meta strong { color: #2563eb; }
    .painel-adv-meta .meta-e { color: #9ca3af; }
    .painel-adv-meta .meta-d { color: #dc2626; }

    .painel-body { flex: 1; overflow-y: auto; padding: 14px; }

    /* Timeline dentro do painel â€” mesmos estilos de jogos.html */
    .timeline-wrap {
      background: #fff; border: 1px solid #e4e4e7;
      border-radius: 14px; overflow: hidden;
    }
    .timeline-item {
      display: grid;
      grid-template-columns: 88px 1fr 28px 52px;
      gap: 12px; align-items: center;
      padding: 10px 16px;
      border-bottom: 1px solid rgba(0,0,0,0.05);
      font-size: 0.82rem;
      transition: filter 0.1s;
    }
    .timeline-item:last-child { border-bottom: none; }
    .timeline-item:hover { filter: brightness(0.93); }
    .timeline-item.vitoria { background: #bfdbfe; }
    .timeline-item.empate  { background: #fde68a; }
    .timeline-item.derrota { background: #fecaca; }

    .timeline-item.vitoria .tl-data   { color: #3b82f6; }
    .timeline-item.vitoria .tl-adv,
    .timeline-item.vitoria .tl-placar { color: #1e40af; }
    .timeline-item.vitoria .tl-comp,
    .timeline-item.vitoria .tl-est    { color: #60a5fa; }
    .timeline-item.empate  .tl-data   { color: #b45309; }
    .timeline-item.empate  .tl-adv,
    .timeline-item.empate  .tl-placar { color: #78350f; }
    .timeline-item.empate  .tl-comp,
    .timeline-item.empate  .tl-est    { color: #d97706; }
    .timeline-item.derrota .tl-data   { color: #ef4444; }
    .timeline-item.derrota .tl-adv,
    .timeline-item.derrota .tl-placar { color: #991b1b; }
    .timeline-item.derrota .tl-comp,
    .timeline-item.derrota .tl-est    { color: #f87171; }

    .tl-data  { color: #9ca3af; font-size: 0.72rem; white-space: nowrap; }
    .tl-info  { min-width: 0; }
    .tl-comp  {
      font-size: 0.6rem; font-weight: 700; letter-spacing: 1.2px;
      text-transform: uppercase; color: #a1a1aa;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .tl-adv   {
      font-weight: 600; white-space: nowrap;
      overflow: hidden; text-overflow: ellipsis; color: #18181b;
    }
    .tl-est   {
      font-size: 0.6rem; font-weight: 700; letter-spacing: 1.2px;
      text-transform: uppercase; color: #a1a1aa;
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }
    .tl-placar {
      font-weight: 900; font-size: 1rem; letter-spacing: -0.5px;
      color: #18181b; white-space: nowrap; text-align: right; width: 52px;
    }
    .tl-mando-icon { font-size: 1rem; line-height: 1; text-align: center; width: 28px; }

    /* â”€â”€ FILTRO PERSONALIZADO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .filtro-custom-wrap {
      display: none; align-items: center; gap: 10px;
      margin-top: 12px; flex-wrap: wrap;
    }
    .filtro-custom-wrap.visivel { display: flex; }
    .filtro-custom-label {
      font-size: 0.65rem; font-weight: 700;
      letter-spacing: 2px; text-transform: uppercase; color: #a1a1aa;
    }
    .filtro-custom-sel {
      background: #fff; color: #18181b; border: 1px solid #d4d4d8;
      border-radius: 10px; padding: 7px 13px; font-size: 0.88rem;
      cursor: pointer; font-family: 'Inter', sans-serif; outline: none;
      font-weight: 700; letter-spacing: -0.3px;
    }
    .filtro-custom-sel:hover { border-color: #a1a1aa; }
    .filtro-custom-sel:focus { border-color: #7c3aed; }
    .filtro-custom-sep {
      font-size: 0.75rem; color: #a1a1aa; font-weight: 600;
    }

    /* â”€â”€ RESPONSIVO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 640px) {
      main { padding-left: 14px; padding-right: 14px; }
      .chart-header { flex-direction: column; }
      .chart-container { height: 240px; }
      .era-stats-grid { grid-template-columns: repeat(3, 1fr); }
      .h2h-grid { grid-template-columns: 1fr; }
      .header-nav .btn-nav:not(:last-child):not(#btn-atualizar) { display: none; }
      .painel { width: 100vw; border-left: none; }
      .timeline-item { grid-template-columns: 68px 1fr 24px 44px; }
      .tl-mando-icon { width: 24px; }
      .tl-placar { width: 44px; font-size: 0.9rem; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">NÃºmeros Fieis <span>- Corinthians</span></div>
  <div class="header-nav">
    <a href="jogos.html" class="btn-nav">Jogos por Ano</a>
    <a href="dashboard.html" class="btn-nav">Dashboard</a>
    <button id="btn-atualizar" class="btn-nav" style="background:none;cursor:pointer;font-family:'Inter',sans-serif;" onclick="atualizarDados()">â†» Atualizar</button>
    <a href="index.html" class="btn-nav">â† InÃ­cio</a>
  </div>
</header>

<!-- â”€â”€ PAINEL LATERAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="painel-overlay" id="painel-overlay" onclick="fecharPainel()"></div>
<div class="painel" id="painel-jogos">
  <div class="painel-header">
    <div class="painel-header-top">
      <div class="painel-adv-nome" id="painel-adv-nome">â€”</div>
      <button class="painel-fechar" onclick="fecharPainel()" title="Fechar">âœ•</button>
    </div>
    <div class="painel-adv-meta" id="painel-adv-meta"></div>
  </div>
  <div class="painel-body">
    <div class="timeline-wrap" id="painel-lista"></div>
  </div>
</div>

<main>
  <div id="loading">
    <div class="spinner"></div>
    Carregando dados...
  </div>

  <div id="conteudo" style="display:none">

    <!-- â”€â”€ FILTROS DE ATALHO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="sec-filtros">
      <div class="section-title">PerÃ­odo de AnÃ¡lise</div>
      <div class="toggle-group" id="filtros-periodo">
        <button class="toggle-btn ativo" data-periodo="era" onclick="alterarPeriodo(this)">Toda a Era</button>
        <button class="toggle-btn titulo-ativo" data-periodo="titulos" onclick="alterarPeriodo(this)">Anos de TÃ­tulo â­</button>
        <button class="toggle-btn" data-periodo="ultimos5" onclick="alterarPeriodo(this)">Ãšltimos 5 Anos</button>
        <button class="toggle-btn" data-periodo="custom" onclick="alterarPeriodo(this)">Personalizado</button>
      </div>
      <div class="filtro-custom-wrap" id="filtro-custom">
        <span class="filtro-custom-label">De</span>
        <select id="ano-de" class="filtro-custom-sel" onchange="atualizar()"></select>
        <span class="filtro-custom-sep">â€”</span>
        <span class="filtro-custom-label">atÃ©</span>
        <select id="ano-ate" class="filtro-custom-sel" onchange="atualizar()"></select>
      </div>
    </section>

    <!-- â”€â”€ GRÃFICO DE PERFORMANCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="sec-grafico">
      <div class="chart-card">
        <div class="chart-header">
          <div class="chart-title-block">
            <div class="chart-title">Performance HistÃ³rica</div>
            <div class="chart-subtitle" id="chart-periodo-label">BrasileirÃ£o SÃ©rie A Â· Era Pontos Corridos (2003â€“2026)</div>
          </div>
          <div class="toggle-group" id="toggles-metrica">
            <button class="toggle-btn ativo" data-metrica="aproveitamento" onclick="alterarMetrica(this)">% Aproveitamento</button>
            <button class="toggle-btn" data-metrica="pontos" onclick="alterarMetrica(this)">Total de Pontos</button>
            <button class="toggle-btn" data-metrica="gols" onclick="alterarMetrica(this)">Gols PrÃ³</button>
          </div>
        </div>
        <div class="chart-container">
          <canvas id="grafico-perf"></canvas>
        </div>
        <div class="chart-legend">
          <div class="legend-item">
            <div class="legend-dot" style="background:#7c3aed"></div>
            Temporada
          </div>
          <div class="legend-item">
            <div class="legend-star"></div>
            TÃ­tulo Conquistado
          </div>
        </div>
      </div>
    </section>

    <!-- â”€â”€ RESUMO DO PERÃODO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="sec-resumo">
      <div class="section-title" id="resumo-titulo">Resumo da Era</div>
      <div class="era-stats-grid" id="era-stats"></div>
    </section>

    <!-- â”€â”€ H2H â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <section id="sec-h2h">
      <div class="section-title">Confronto Direto por AdversÃ¡rio</div>
      <div class="h2h-search-wrap">
        <input type="text" id="h2h-busca" placeholder="Buscar adversÃ¡rioâ€¦" oninput="filtrarH2H()" autocomplete="off">
        <div class="h2h-sort-group">
          <button class="h2h-sort-btn ativo" data-sort="jogos" onclick="reordenarH2H(this)">Por Jogos</button>
          <button class="h2h-sort-btn" data-sort="aproveitamento" onclick="reordenarH2H(this)">Por Aprovt.</button>
          <button class="h2h-sort-btn" data-sort="vitorias" onclick="reordenarH2H(this)">Por VitÃ³rias</button>
        </div>
      </div>
      <div id="h2h-resumo-container"></div>
      <div class="h2h-grid" id="h2h-grid"></div>
    </section>

  </div><!-- /#conteudo -->
</main>

<script>
// Registra plugin de datalabels
Chart.register(ChartDataLabels);

const API_URL = "/api/dados";
const TITULOS = [2005, 2011, 2015, 2017];
const ANO_MIN = 2003;

let dadosTodos      = [];
let dadosBrasileirao = [];
let periodoAtivo    = 'era';
let metricaAtiva    = 'aproveitamento';
let sortAtivo       = 'jogos';
let h2hDados        = [];
let grafico         = null;

// â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function rNorm(v) {
  return (v || '').toUpperCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "").trim();
}
function limpar(val) {
  if (val === null || val === undefined || val === '') return '';
  return String(val).normalize('NFC')
    .replace(/[\u00A0\u200B-\u200D\uFEFF\u2028\u2029\u0000-\u001F\u007F]/g, '')
    .replace(/\s+/g, ' ').trim();
}
function formatarData(valor) {
  if (!valor) return '';
  if (typeof valor === 'string' && valor.includes('/')) return valor;
  try {
    const d = new Date(valor);
    if (isNaN(d)) return valor;
    return String(d.getUTCDate()).padStart(2,'0') + '/' +
           String(d.getUTCMonth()+1).padStart(2,'0') + '/' + d.getUTCFullYear();
  } catch(e) { return valor; }
}
function parseDataBR(str) {
  if (!str) return new Date(0);
  const p = str.split('/');
  return p.length === 3 ? new Date(p[2], p[1]-1, p[0]) : new Date(str);
}
function normalizar(data) {
  return data.map(row => ({
    d:   formatarData(row["DATA"]),
    a:   row["ANO COMPETICAO"],
    m:   limpar(row["MANDO"]),
    p:   (row["GOL CORINTHIANS"] === "" ? "0" : row["GOL CORINTHIANS"]) + "x" +
         (row["GOL ADVERSARIO"] === "" ? "0" : row["GOL ADVERSARIO"]),
    r:   limpar(row["RESULTADO"]),
    adv: limpar(row["TIME ADVERSARIO"]),
    c:   limpar(row["COMPETIÃ‡ÃƒO"]),
    e:   limpar(row["ESTADIO"]),
    t:   limpar(row["TECNICO CORINTHIANS"]),
  }));
}

// â”€â”€ Parsing â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
// No BrasileirÃ£o SÃ©rie A (formato liga) o resultado Ã© sempre determinado
// pelo placar: nÃ£o hÃ¡ prorrogaÃ§Ã£o nem pÃªnaltis na fase de classificaÃ§Ã£o.
// Derivar o resultado pelo placar evita erros pontuais na coluna RESULTADO.
function resultadoPorPlacar(placar) {
  const parts = (placar || '0x0').split('x');
  const pro = parseInt(parts[0]) || 0;
  const con = parseInt(parts[1]) || 0;
  const r = pro > con ? 'VITORIA' : pro < con ? 'DERROTA' : 'EMPATE';
  return { r, pro, con };
}
function parseJogo(j) {
  return resultadoPorPlacar(j.p);
}

// â”€â”€ CÃ¡lculo por ano â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcularPorAno(jogos) {
  const mapa = {};
  jogos.forEach(j => {
    const ano = parseInt(j.a);
    if (!mapa[ano]) mapa[ano] = { v:0, e:0, d:0, total:0, pts:0, gp:0, gc:0 };
    const { r, pro, con } = parseJogo(j);
    mapa[ano].gp += pro; mapa[ano].gc += con; mapa[ano].total++;
    if (r === 'VITORIA')      { mapa[ano].v++; mapa[ano].pts += 3; }
    else if (r === 'EMPATE')  { mapa[ano].e++; mapa[ano].pts += 1; }
    else if (r === 'DERROTA') { mapa[ano].d++; }
  });
  return Object.entries(mapa)
    .sort((a,b) => parseInt(a[0]) - parseInt(b[0]))
    .map(([ano, s]) => ({
      ano: parseInt(ano), ...s,
      aproveitamento: s.total > 0 ? (s.pts / (s.total * 3) * 100) : 0,
    }));
}

// â”€â”€ CÃ¡lculo agregado â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcularAgregado(jogos) {
  let v=0, e=0, d=0, total=0, pts=0, gp=0, gc=0;
  jogos.forEach(j => {
    const { r, pro, con } = parseJogo(j);
    gp += pro; gc += con; total++;
    if (r === 'VITORIA')      { v++; pts += 3; }
    else if (r === 'EMPATE')  { e++; pts += 1; }
    else if (r === 'DERROTA') { d++; }
  });
  return { v, e, d, total, pts, gp, gc,
    aproveitamento: total > 0 ? (pts / (total * 3) * 100) : 0 };
}

// â”€â”€ CÃ¡lculo H2H â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function calcularH2H(jogos) {
  const mapa = {};
  jogos.forEach(j => {
    const adv = j.adv || 'Desconhecido';
    if (!mapa[adv]) mapa[adv] = { v:0, e:0, d:0, total:0, pts:0, gp:0, gc:0 };
    const { r, pro, con } = parseJogo(j);
    mapa[adv].gp += pro; mapa[adv].gc += con; mapa[adv].total++;
    if (r === 'VITORIA')      { mapa[adv].v++; mapa[adv].pts += 3; }
    else if (r === 'EMPATE')  { mapa[adv].e++; mapa[adv].pts += 1; }
    else if (r === 'DERROTA') { mapa[adv].d++; }
  });
  return Object.entries(mapa).map(([adv, s]) => ({
    adv, ...s,
    aproveitamento: s.total > 0 ? (s.pts / (s.total * 3) * 100) : 0,
  }));
}

// â”€â”€ Filtro de perÃ­odo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getAnosFiltro() {
  const anosDisponiveis = [...new Set(dadosBrasileirao.map(j => parseInt(j.a)))].filter(Boolean).sort((a,b)=>a-b);
  if (periodoAtivo === 'titulos')  return TITULOS.filter(a => anosDisponiveis.includes(a));
  if (periodoAtivo === 'ultimos5') {
    const ultimo = anosDisponiveis[anosDisponiveis.length - 1];
    return anosDisponiveis.filter(a => a >= ultimo - 4);
  }
  if (periodoAtivo === 'custom') {
    const de  = parseInt(document.getElementById('ano-de').value)  || anosDisponiveis[0];
    const ate = parseInt(document.getElementById('ano-ate').value) || anosDisponiveis[anosDisponiveis.length - 1];
    return anosDisponiveis.filter(a => a >= Math.min(de, ate) && a <= Math.max(de, ate));
  }
  return anosDisponiveis;
}
function getJogosFiltrados() {
  const anos = new Set(getAnosFiltro());
  return dadosBrasileirao.filter(j => anos.has(parseInt(j.a)));
}

// â”€â”€ GrÃ¡fico â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderizarGrafico(porAno) {
  const anos    = porAno.map(s => s.ano);
  const valorFn = {
    aproveitamento: s => parseFloat(s.aproveitamento.toFixed(1)),
    pontos:         s => s.pts,
    gols:           s => s.gp,
  };
  const valores = porAno.map(valorFn[metricaAtiva]);

  const isTitulo     = anos.map(a => TITULOS.includes(a));
  const pontoCores   = isTitulo.map(t => t ? '#f59e0b' : '#7c3aed');
  const pontoRaio    = isTitulo.map(t => t ? 9 : 5);
  const pontoBorda   = isTitulo.map(t => t ? '#d97706' : '#5b21b6');

  const labels = anos.map(a => String(a) + (TITULOS.includes(a) ? ' â­' : ''));

  const ctx = document.getElementById('grafico-perf').getContext('2d');
  const gradient = ctx.createLinearGradient(0, 0, 0, 300);
  gradient.addColorStop(0, 'rgba(124,58,237,0.16)');
  gradient.addColorStop(1, 'rgba(124,58,237,0)');

  const yConfig = {
    aproveitamento: { min: 0, max: 100, suffix: '%' },
    pontos:         { min: 0, max: null, suffix: '' },
    gols:           { min: 0, max: null, suffix: '' },
  }[metricaAtiva];

  // Formato do rÃ³tulo
  const labelFmt = v => {
    if (metricaAtiva === 'aproveitamento') return v.toFixed(1) + '%';
    return String(v);
  };

  if (grafico) { grafico.destroy(); }

  grafico = new Chart(ctx, {
    type: 'line',
    data: {
      labels,
      datasets: [{
        data: valores,
        borderColor: '#7c3aed',
        backgroundColor: gradient,
        borderWidth: 2.5,
        fill: true,
        tension: 0.35,
        pointBackgroundColor: pontoCores,
        pointBorderColor: pontoBorda,
        pointBorderWidth: 2,
        pointRadius: pontoRaio,
        pointHoverRadius: isTitulo.map(t => t ? 12 : 8),
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      layout: { padding: { top: 28 } },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#18181b',
          titleColor: '#f4f4f5',
          bodyColor: '#a1a1aa',
          padding: 12, cornerRadius: 10,
          titleFont: { family: 'Inter', weight: '700', size: 13 },
          bodyFont: { family: 'Inter', size: 11 },
          callbacks: {
            title: (items) => {
              const idx = items[0].dataIndex;
              const ano = anos[idx];
              return ano + (TITULOS.includes(ano) ? '  â­ TÃ­tulo' : '');
            },
            afterTitle: (items) => {
              const s = porAno[items[0].dataIndex];
              return 'J ' + s.total + '  V ' + s.v + '  E ' + s.e + '  D ' + s.d;
            },
            label: (item) => {
              const s = porAno[item.dataIndex];
              if (metricaAtiva === 'aproveitamento')
                return '  ' + s.aproveitamento.toFixed(1) + '%  (' + s.pts + '/' + (s.total*3) + ' pts)';
              if (metricaAtiva === 'pontos')
                return '  ' + s.pts + ' de ' + (s.total*3) + ' pts possÃ­veis';
              return '  GP ' + s.gp + '  GC ' + s.gc + '  Saldo ' + (s.gp - s.gc >= 0 ? '+' : '') + (s.gp - s.gc);
            },
          }
        },
        datalabels: {
          display: true,
          anchor: 'end',
          align: 'top',
          offset: 2,
          clip: false,
          formatter: labelFmt,
          color: (ctx) => isTitulo[ctx.dataIndex] ? '#92400e' : '#5b21b6',
          backgroundColor: (ctx) => isTitulo[ctx.dataIndex] ? '#fef3c7' : 'rgba(237,233,254,0.85)',
          borderRadius: 4,
          padding: { top: 3, bottom: 3, left: 5, right: 5 },
          font: { family: 'Inter', weight: '700', size: 10 },
        },
      },
      scales: {
        x: {
          grid: { color: '#f0f0f2' },
          ticks: { color: '#9ca3af', font: { family: 'Inter', size: 11 }, maxRotation: 45, minRotation: 0 },
        },
        y: {
          min: yConfig.min,
          max: yConfig.max,
          grid: { color: '#e4e4e7' },
          ticks: {
            color: '#9ca3af', font: { family: 'Inter', size: 11 },
            callback: v => v + yConfig.suffix,
          },
        },
      },
    },
  });
}

// â”€â”€ Resumo â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderizarResumo(jogos) {
  const s = calcularAgregado(jogos);
  const saldo = s.gp - s.gc;
  const aprov = s.total > 0 ? s.aproveitamento.toFixed(1) : '0.0';
  document.getElementById('era-stats').innerHTML = [
    { val: s.total,                              lbl: 'Jogos',          cls: '' },
    { val: s.v,                                  lbl: 'VitÃ³rias',       cls: 'destaque-v' },
    { val: s.e,                                  lbl: 'Empates',        cls: '' },
    { val: s.d,                                  lbl: 'Derrotas',       cls: 'destaque-d' },
    { val: aprov + '%',                          lbl: 'Aproveitamento', cls: 'destaque-aprov' },
    { val: s.pts,                                lbl: 'Pontos',         cls: '' },
    { val: s.gp,                                 lbl: 'Gols PrÃ³',       cls: 'destaque-gp' },
    { val: s.gc,                                 lbl: 'Gols Contra',    cls: 'destaque-gc' },
    { val: (saldo >= 0 ? '+' : '') + saldo,     lbl: 'Saldo de Gols',  cls: saldo >= 0 ? 'destaque-v' : 'destaque-d' },
  ].map(item => `
    <div class="era-stat-card ${item.cls}">
      <div class="era-stat-valor">${item.val}</div>
      <div class="era-stat-label">${item.lbl}</div>
    </div>`).join('');
}

// â”€â”€ H2H â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function cardColorClass(s) {
  if (s.v > s.d) return 'h2h-vence';
  if (s.v < s.d) return 'h2h-perde';
  return 'h2h-equilibrado';
}

function sortH2H(lista, campo) {
  return [...lista].sort((a, b) => {
    if (campo === 'aproveitamento') return b.aproveitamento - a.aproveitamento;
    if (campo === 'vitorias')       return b.v - a.v;
    return b.total - a.total;
  });
}

function renderizarH2H(lista) {
  if (lista.length === 0) {
    document.getElementById('h2h-grid').innerHTML =
      '<div style="color:#a1a1aa;font-size:0.82rem;padding:20px 0">Nenhum adversÃ¡rio encontrado.</div>';
    return;
  }
  document.getElementById('h2h-grid').innerHTML = lista.map(s => {
    const pctV = s.total > 0 ? (s.v / s.total * 100) : 0;
    const pctE = s.total > 0 ? (s.e / s.total * 100) : 0;
    const pctD = s.total > 0 ? (s.d / s.total * 100) : 0;
    const saldo    = s.gp - s.gc;
    const saldoStr = (saldo >= 0 ? '+' : '') + saldo;
    const cls      = cardColorClass(s);
    const advEsc   = s.adv.replace(/"/g, '&quot;');
    return `
      <div class="h2h-card ${cls}" onclick="abrirPainel('${advEsc}')" title="Ver jogos contra ${advEsc}">
        <div class="h2h-header">
          <div class="h2h-adv" title="${advEsc}">${s.adv}</div>
          <div class="h2h-aprov">${s.aproveitamento.toFixed(0)}%</div>
        </div>
        <div class="h2h-record">
          <div class="h2h-record-item h2h-v"><span class="val">${s.v}</span><span class="lbl"> V</span></div>
          <span class="h2h-record-sep">Â·</span>
          <div class="h2h-record-item h2h-e"><span class="val">${s.e}</span><span class="lbl"> E</span></div>
          <span class="h2h-record-sep">Â·</span>
          <div class="h2h-record-item h2h-d"><span class="val">${s.d}</span><span class="lbl"> D</span></div>
          <div class="h2h-jogos">${s.total} jogo${s.total !== 1 ? 's' : ''}</div>
        </div>
        <div class="h2h-bar">
          <div class="h2h-bar-seg h2h-bar-v" style="width:${pctV.toFixed(1)}%"></div>
          <div class="h2h-bar-seg h2h-bar-e" style="width:${pctE.toFixed(1)}%"></div>
          <div class="h2h-bar-seg h2h-bar-d" style="width:${pctD.toFixed(1)}%"></div>
        </div>
        <div class="h2h-gols">
          <span>GP <span>${s.gp}</span></span>
          <span>GC <span>${s.gc}</span></span>
          <span>Saldo <span style="color:${saldo >= 0 ? '#2563eb' : '#dc2626'}">${saldoStr}</span></span>
        </div>
        <div class="h2h-hint">Ver jogos â†’</div>
      </div>`;
  }).join('');
}

function filtrarH2H() {
  const termo = rNorm(document.getElementById('h2h-busca').value);
  const lista = sortH2H(h2hDados, sortAtivo).filter(s =>
    !termo || rNorm(s.adv).includes(termo)
  );
  renderizarH2H(lista);
}

function reordenarH2H(btn) {
  document.querySelectorAll('.h2h-sort-btn').forEach(b => b.classList.remove('ativo'));
  btn.classList.add('ativo');
  sortAtivo = btn.dataset.sort;
  filtrarH2H();
}

// â”€â”€ Painel de jogos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function abrirPainel(adv) {
  // Respeita o filtro de perÃ­odo ativo
  const jogosAdv = getJogosFiltrados().filter(j => j.adv === adv)
    .sort((a, b) => parseDataBR(b.d) - parseDataBR(a.d));

  const ag = calcularAgregado(jogosAdv);

  const anosAdv = getAnosFiltro();
  const periodoMeta = {
    era:      'BrasileirÃ£o Â· Toda a Era',
    titulos:  'BrasileirÃ£o Â· Anos de TÃ­tulo',
    ultimos5: 'BrasileirÃ£o Â· Ãšltimos 5 Anos',
    custom:   `BrasileirÃ£o Â· ${Math.min(...anosAdv)}â€“${Math.max(...anosAdv)}`,
  }[periodoAtivo] || 'BrasileirÃ£o';

  document.getElementById('painel-adv-nome').textContent = adv;
  document.getElementById('painel-adv-meta').innerHTML =
    `${periodoMeta} Â· ${ag.total} jogo${ag.total !== 1 ? 's' : ''} Â· ` +
    `<strong>${ag.v}V</strong> Â· ` +
    `<span class="meta-e">${ag.e}E</span> Â· ` +
    `<span class="meta-d">${ag.d}D</span> Â· ` +
    `Aprovt: ${ag.aproveitamento.toFixed(1)}%`;

  document.getElementById('painel-lista').innerHTML = jogosAdv.map(j => {
    const { r } = resultadoPorPlacar(j.p);
    const cl = r === 'VITORIA' ? 'vitoria' : r === 'EMPATE' ? 'empate' : 'derrota';
    const mandoNorm = rNorm(j.m);
    const isCasa = mandoNorm.includes('CASA') || mandoNorm === 'MANDANTE';
    const isFora = mandoNorm.includes('FORA') || mandoNorm === 'VISITANTE';
    const icone  = isCasa ? 'ğŸ ' : isFora ? 'âœˆï¸' : 'ğŸŸï¸';
    return `<div class="timeline-item ${cl}">
      <span class="tl-data">${j.d}</span>
      <div class="tl-info">
        <div class="tl-comp">${j.c || 'â€”'} Â· ${j.a}</div>
        <div class="tl-est">${j.e || 'â€”'}</div>
        <div class="tl-adv">${j.adv || 'â€”'}</div>
      </div>
      <span class="tl-mando-icon" title="${j.m || ''}">${icone}</span>
      <span class="tl-placar">${j.p}</span>
    </div>`;
  }).join('');

  document.getElementById('painel-overlay').classList.add('aberto');
  document.getElementById('painel-jogos').classList.add('aberto');
  document.body.style.overflow = 'hidden';
}

function fecharPainel() {
  document.getElementById('painel-overlay').classList.remove('aberto');
  document.getElementById('painel-jogos').classList.remove('aberto');
  document.body.style.overflow = '';
}

// Fecha com Esc
document.addEventListener('keydown', e => { if (e.key === 'Escape') fecharPainel(); });

// â”€â”€ AtualizaÃ§Ã£o geral â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function atualizar() {
  const anos  = getAnosFiltro();
  const jogos = getJogosFiltrados();

  const periodoLabels = {
    era:      `BrasileirÃ£o SÃ©rie A Â· Era Pontos Corridos (${ANO_MIN}â€“${Math.max(...anos)})`,
    titulos:  'BrasileirÃ£o Â· Anos de TÃ­tulo â€” 2005, 2011, 2015, 2017',
    ultimos5: `BrasileirÃ£o Â· Ãšltimos 5 Anos (${Math.min(...anos)}â€“${Math.max(...anos)})`,
    custom:   `BrasileirÃ£o Â· PerÃ­odo Personalizado (${Math.min(...anos)}â€“${Math.max(...anos)})`,
  };
  document.getElementById('chart-periodo-label').textContent = periodoLabels[periodoAtivo] || periodoLabels.era;

  const resumoLabels = {
    era:      'Resumo da Era (2003â€“' + Math.max(...anos) + ')',
    titulos:  'Resumo dos Anos de TÃ­tulo',
    ultimos5: 'Resumo dos Ãšltimos 5 Anos',
    custom:   `Resumo do PerÃ­odo (${Math.min(...anos)}â€“${Math.max(...anos)})`,
  };
  document.getElementById('resumo-titulo').textContent = resumoLabels[periodoAtivo] || resumoLabels.era;

  renderizarGrafico(calcularPorAno(jogos));
  renderizarResumo(jogos);

  h2hDados = calcularH2H(jogos);
  document.getElementById('h2h-busca').value = '';
  renderizarResumoH2H(h2hDados);
  filtrarH2H();
}

// â”€â”€ Resumo de confrontos â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderizarResumoH2H(lista) {
  const total = lista.length;
  if (total === 0) { document.getElementById('h2h-resumo-container').innerHTML = ''; return; }

  const vence = lista.filter(s => s.v > s.d).length;
  const equil = lista.filter(s => s.v === s.d).length;
  const perde = lista.filter(s => s.v < s.d).length;

  const pctV = (vence / total * 100).toFixed(1);
  const pctE = (equil / total * 100).toFixed(1);
  const pctD = (perde / total * 100).toFixed(1);

  document.getElementById('h2h-resumo-container').innerHTML = `
    <div class="h2h-resumo">
      <div class="h2h-resumo-card rc-vence">
        <div class="h2h-resumo-num">${vence}</div>
        <div class="h2h-resumo-txt">
          <div class="h2h-resumo-label">Vantagem<br>(V &gt; D)</div>
          <div class="h2h-resumo-sub">${pctV}% dos rivais</div>
        </div>
      </div>
      <div class="h2h-resumo-card rc-equilibrado">
        <div class="h2h-resumo-num">${equil}</div>
        <div class="h2h-resumo-txt">
          <div class="h2h-resumo-label">EquilÃ­brio<br>(V = D)</div>
          <div class="h2h-resumo-sub">${pctE}% dos rivais</div>
        </div>
      </div>
      <div class="h2h-resumo-card rc-perde">
        <div class="h2h-resumo-num">${perde}</div>
        <div class="h2h-resumo-txt">
          <div class="h2h-resumo-label">Desvantagem<br>(V &lt; D)</div>
          <div class="h2h-resumo-sub">${pctD}% dos rivais</div>
        </div>
      </div>
    </div>
    <div class="h2h-resumo-barra-wrap">
      <div class="h2h-resumo-barra">
        <div class="hrb-v" style="width:${pctV}%"></div>
        <div class="hrb-e" style="width:${pctE}%"></div>
        <div class="hrb-d" style="width:${pctD}%"></div>
      </div>
    </div>`;
}

// â”€â”€ Event handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function alterarPeriodo(btn) {
  document.querySelectorAll('#filtros-periodo .toggle-btn').forEach(b =>
    b.classList.remove('ativo', 'titulo-ativo'));
  const novo = btn.dataset.periodo;
  btn.classList.add(novo === 'titulos' ? 'titulo-ativo' : 'ativo');
  periodoAtivo = novo;
  // Mostra/esconde seletor de anos personalizado
  document.getElementById('filtro-custom').classList.toggle('visivel', novo === 'custom');
  atualizar();
}

function alterarMetrica(btn) {
  document.querySelectorAll('#toggles-metrica .toggle-btn').forEach(b => b.classList.remove('ativo'));
  btn.classList.add('ativo');
  metricaAtiva = btn.dataset.metrica;
  const anos  = new Set(getAnosFiltro());
  const jogos = dadosBrasileirao.filter(j => anos.has(parseInt(j.a)));
  renderizarGrafico(calcularPorAno(jogos));
}

// â”€â”€ InicializaÃ§Ã£o â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function iniciar() {
  try {
    let rawData = null;
    try {
      const cached = sessionStorage.getItem('nf_dados_cache');
      if (cached) rawData = JSON.parse(cached);
    } catch(e) { rawData = null; }

    if (!rawData) {
      const resp = await fetch(API_URL);
      const json = await resp.json();
      if (!json.data) throw new Error('Sem dados');
      rawData = json.data;
      try { sessionStorage.setItem('nf_dados_cache', JSON.stringify(rawData)); } catch(e) {}
    }

    dadosTodos = normalizar(rawData);

    dadosBrasileirao = dadosTodos.filter(j => {
      const comp = rNorm(j.c);
      const ano  = parseInt(j.a);
      // Exclui SÃ©rie B (ex: 2008) e restringe ao perÃ­odo pontos corridos
      return comp.includes('BRASILEIRO') && !comp.includes('SERIE B') && ano >= ANO_MIN;
    });

    if (dadosBrasileirao.length === 0) {
      document.getElementById('loading').innerHTML =
        'Nenhum dado de Campeonato Brasileiro encontrado na base.';
      return;
    }

    // Popula selects do perÃ­odo personalizado
    const anosDisp = [...new Set(dadosBrasileirao.map(j => parseInt(j.a)))].filter(Boolean).sort((a,b)=>a-b);
    const selDe  = document.getElementById('ano-de');
    const selAte = document.getElementById('ano-ate');
    // SÃ³ repopula se vazio (evita duplicar ao atualizar)
    if (selDe.options.length === 0) {
      anosDisp.forEach(a => {
        selDe.add(new Option(a, a));
        selAte.add(new Option(a, a));
      });
      selDe.value  = anosDisp[0];
      selAte.value = anosDisp[anosDisp.length - 1];
    }

    document.getElementById('loading').style.display = 'none';
    document.getElementById('conteudo').style.display = '';
    atualizar();

  } catch(err) {
    document.getElementById('loading').innerHTML = 'Erro ao carregar dados.';
    console.error(err);
  }
}

// â”€â”€ Atualizar dados â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function atualizarDados() {
  const btn = document.getElementById('btn-atualizar');
  if (btn) { btn.textContent = 'Atualizando...'; btn.disabled = true; }

  try { sessionStorage.removeItem('nf_dados_cache'); } catch(e) {}
  dadosTodos = [];
  dadosBrasileirao = [];
  h2hDados = [];
  if (grafico) { grafico.destroy(); grafico = null; }
  // Limpa selects para que sejam re-populados com dados frescos
  document.getElementById('ano-de').innerHTML = '';
  document.getElementById('ano-ate').innerHTML = '';

  // Reseta UI e mostra loading
  const loadEl = document.getElementById('loading');
  loadEl.innerHTML = '<div class="spinner"></div>Atualizando dados...';
  loadEl.style.display = '';
  document.getElementById('conteudo').style.display = 'none';

  await iniciar();

  if (btn) { btn.textContent = 'â†» Atualizar'; btn.disabled = false; }
}

iniciar();
</script>
</body>
</html>
